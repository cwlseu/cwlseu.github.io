<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.deepindeed.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":28},"copycode":false,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Python入门简单，但是无论哪种语言，都有语言设计者赋予其中的特殊意义的东西，可能是为了方便，可能是为了得到高的level,无论出发点是什么，都是值得我学习探究的。">
<meta property="og:type" content="article">
<meta property="og:title" content="Python中的一些奇淫技巧">
<meta property="og:url" content="http://www.deepindeed.cn/201812/20181214-python-tips/index.html">
<meta property="og:site_name" content="Deepindeed">
<meta property="og:description" content="Python入门简单，但是无论哪种语言，都有语言设计者赋予其中的特殊意义的东西，可能是为了方便，可能是为了得到高的level,无论出发点是什么，都是值得我学习探究的。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-12-14T04:14:00.000Z">
<meta property="article:modified_time" content="2022-08-29T15:26:38.393Z">
<meta property="article:author" content="CharlesCao">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://www.deepindeed.cn/201812/20181214-python-tips/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://www.deepindeed.cn/201812/20181214-python-tips/","path":"201812/20181214-python-tips/","title":"Python中的一些奇淫技巧"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Python中的一些奇淫技巧 | Deepindeed</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-86501439-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-86501439-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>




<link rel="dns-prefetch" href="https://waline.vercel.app"><link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Deepindeed</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">In me the tiger sniffs the rose.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-tools"><a href="/tools/" rel="section"><i class="fa fa-globe fa-fw"></i>tools</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.</span> <span class="nav-text">变量类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%97%E8%A1%A8%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">3.</span> <span class="nav-text">列表生成器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="nav-number">4.</span> <span class="nav-text">装饰器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python-%E8%B0%83%E7%94%A8%E6%9C%BA%E5%88%B6"><span class="nav-number">5.</span> <span class="nav-text">Python 调用机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="nav-number">6.</span> <span class="nav-text">描述符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python-%E7%BB%A7%E6%89%BF%E6%9C%BA%E5%88%B6"><span class="nav-number">7.</span> <span class="nav-text">Python 继承机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python-%E7%89%B9%E6%AE%8A%E6%96%B9%E6%B3%95"><span class="nav-number">8.</span> <span class="nav-text">Python 特殊方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%98%AF%E7%9C%9F%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%90%97"><span class="nav-number">9.</span> <span class="nav-text">多线程是真的多线程吗？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python%E4%B8%AD%E4%B8%80%E4%BA%9B%E5%BF%BD%E8%A7%86%E7%9A%84%E6%80%A7%E8%B4%A8"><span class="nav-number">10.</span> <span class="nav-text">Python中一些忽视的性质</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="nav-number">11.</span> <span class="nav-text">常见问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pip%E5%AE%89%E8%A3%85package%E5%87%BA%E7%8E%B0read-timed-out."><span class="nav-number">12.</span> <span class="nav-text">pip安装package出现Read timed
out.</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">12.1.</span> <span class="nav-text">解决方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="nav-number">13.</span> <span class="nav-text">参考文献</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CharlesCao"
      src="/images/bird.png">
  <p class="site-author-name" itemprop="name">CharlesCao</p>
  <div class="site-description" itemprop="description">心有猛虎，细嗅蔷薇。</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">36</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:caowenlong92@gmail.com" title="E-Mail → mailto:caowenlong92@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/5221628" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;5221628" rel="noopener" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/cwlseu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cwlseu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://deepindeed.cn/" title="https:&#x2F;&#x2F;deepindeed.cn" rel="noopener" target="_blank">Title</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://pytorch.org/" title="https:&#x2F;&#x2F;pytorch.org" rel="noopener" target="_blank">Pytorch</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://cplusplus.com/reference" title="https:&#x2F;&#x2F;cplusplus.com&#x2F;reference" rel="noopener" target="_blank">CppReference</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://docs.nvidia.com/cuda/index.html" title="https:&#x2F;&#x2F;docs.nvidia.com&#x2F;cuda&#x2F;index.html" rel="noopener" target="_blank">NVIDIA CUDA</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.deepindeed.cn/201812/20181214-python-tips/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bird.png">
      <meta itemprop="name" content="CharlesCao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Deepindeed">
      <meta itemprop="description" content="心有猛虎，细嗅蔷薇。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Python中的一些奇淫技巧 | Deepindeed">
      <meta itemprop="description" content="Python入门简单，但是无论哪种语言，都有语言设计者赋予其中的特殊意义的东西，可能是为了方便，可能是为了得到高的level,无论出发点是什么，都是值得我学习探究的。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Python中的一些奇淫技巧
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-12-14 12:14:00" itemprop="dateCreated datePublished" datetime="2018-12-14T12:14:00+08:00">2018-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-29 23:26:38" itemprop="dateModified" datetime="2022-08-29T23:26:38+08:00">2022-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/blog/" itemprop="url" rel="index"><span itemprop="name">blog</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">评论数：</span>
  
    <a title="waline" href="/201812/20181214-python-tips/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/201812/20181214-python-tips/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>24 分钟</span>
    </span>
</div>

            <div class="post-description">Python入门简单，但是无论哪种语言，都有语言设计者赋予其中的特殊意义的东西，可能是为了方便，可能是为了得到高的level,无论出发点是什么，都是值得我学习探究的。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="前言">前言</h2>
<p>最近觉得 Python 太“简单了”，于是在师父川爷面前放肆了一把：“我觉得
Python 是世界上最简单的语言！”。于是川爷嘴角闪过了一丝轻蔑的微笑（内心
OS：Naive！，作为一个 Python
开发者，我必须要给你一点人生经验，不然你不知道天高地厚！）于是川爷给我了一份满分100分的题，然后这篇文章就是记录下做这套题所踩过的坑。</p>
<h2 id="变量类型">变量类型</h2>
<p>这是关于list的数据类型的理解。觉得如下程序会输出怎么样的结果？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x, L = []</span>):</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x):</span><br><span class="line">		L.append(i*i)</span><br><span class="line">	<span class="built_in">print</span>(L)</span><br><span class="line">	<span class="built_in">print</span>(<span class="built_in">id</span>(L))</span><br><span class="line"></span><br><span class="line">f(<span class="number">2</span>)</span><br><span class="line">f(<span class="number">2</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">f(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p>输出结果如下 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[0, 1]</span><br><span class="line">139664725541736</span><br><span class="line">[1, 2, 3, 0, 1]</span><br><span class="line">139664725491584</span><br><span class="line">[0, 1, 0, 1, 4]</span><br><span class="line">139664725541736</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>在python中的数据可以分为可变数据类型和不变数据类型。
可变数据类型：像tuple,list,dict之类的变量就是可变数据类型，变量名存储的是一个地址，
该地址指向一个具体的对象，并且不管对变量的值即对象做怎么样的操作，都不会改变变量名存储的地址。
我们把列表作为参数传入一个函数时，在函数内我们对该列表进行了一些改变，由于变量存储的地址没有变
，所以就算我们没有故意通过return语句把该列表传递出来，该列表还是会在函数执行结束后跟着改变的。</p></li>
<li><p>函数的默认值为可变数据类型的话，会申请一个变量，这个变量地址是固定的，但是值在函数可被改变，
而且还会影响下次调用。</p></li>
</ul>
<p>同样的道理, 如果对不可变数据类型作为输入参数的话，会有什么结果？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">g</span>(<span class="params">x, s=<span class="string">&quot;&quot;</span></span>):</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x):</span><br><span class="line">		s += <span class="built_in">str</span>(<span class="string">&quot;&#123;&#125; &quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">	<span class="built_in">print</span>(s)</span><br><span class="line">	<span class="built_in">print</span>(<span class="built_in">id</span>(x), <span class="built_in">id</span>(s))</span><br><span class="line">g(<span class="number">2</span>)</span><br><span class="line">ss = <span class="string">&quot;hello&quot;</span></span><br><span class="line">g(<span class="number">3</span>, ss)</span><br><span class="line">g(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>输出结果如下： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0 1 </span><br><span class="line">(42414400, 140100353397648)</span><br><span class="line">140100353385936</span><br><span class="line">hello0 1 2 </span><br><span class="line">(42414376, 140100353397648)</span><br><span class="line">0 1 </span><br><span class="line">(42414400, 140100353397648)</span><br></pre></td></tr></table></figure>
从中可以看出，不可变数据类型的情况下，其中的 *
默认值是空没有随着函数调用被改变,与函数是绑定的关系，不信你可以测试一下相对位置是不变的；
* 而且在python语言的世界里，数字类型也是一个引用哦；</p>
<h2 id="列表生成器">列表生成器</h2>
<blockquote>
<p>描述:</p>
</blockquote>
<pre><code>下面的代码会报错，为什么？</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">classA(<span class="built_in">object</span>):</span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    gen = (xfor_inxrange(<span class="number">10</span>))<span class="comment"># gen=(x for _ in range(10))</span></span><br><span class="line">    if__name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(A.gen))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>答案</p>
</blockquote>
<p>这个问题是变量作用域问题，在 gen=(x for _ in xrange(10)) 中 gen
是一个 generator ,在
generator中变量有自己的一套作用域，与其余作用域空间相互隔离。因此，将会出现这样的
NameError: name 'x' is not defined
的问题，那么解决方案是什么呢？答案是：用 lambda 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">classA(<span class="built_in">object</span>):</span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    gen = (lambdax: (xfor_inxrange(<span class="number">10</span>)))(x)<span class="comment"># gen=(x for _ in range(10))</span></span><br><span class="line">    if__name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(A.gen))</span><br></pre></td></tr></table></figure>
<h2 id="装饰器">装饰器</h2>
<blockquote>
<p>描述</p>
</blockquote>
<p>我想写一个类装饰器用来度量函数/方法运行时间</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Timeit</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, func</span>):</span><br><span class="line">        self._wrapped = func</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, *args, **kws</span>):</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        result = self._wrapped(*args, **kws)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;elapsed time is %s &quot;</span> % (time.time() - start_time))</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>这个装饰器能够运行在普通函数上：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Timeit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span><span class="string">&quot;invoking function func&quot;</span></span><br><span class="line"></span><br><span class="line">if__name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    func()<span class="comment"># output: elapsed time is 1.00044410133</span></span><br></pre></td></tr></table></figure>
<p>但是运行在方法上会报错，为什么？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Timeit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span><span class="string">&quot;invoking function func&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @Timeit</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">self</span>):</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span><span class="string">&#x27;invoking method func&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    a = A()</span><br><span class="line">    a.func()<span class="comment"># Boom!</span></span><br></pre></td></tr></table></figure>
<p>如果我坚持使用类装饰器，应该如何修改？</p>
<blockquote>
<p>答案</p>
</blockquote>
<p>使用类装饰器后，在调用 <code>func</code> 函数的过程中其对应的
instance 并不会传递给 <code>__call__</code>方法，造成其 mehtod unbound
,那么解决方法是什么呢？描述符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Timeit</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,func</span>):</span><br><span class="line">        self.func = func</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;invoking Timer&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__get__</span>(<span class="params">self, instance, owner</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">lambda</span> *args, **kwargs: self.func(instance, *args, **kwargs)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Timeit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span><span class="string">&quot;invoking function func&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @Timeit</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">self</span>):</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span><span class="string">&#x27;invoking method func&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    a = A()</span><br><span class="line">    <span class="built_in">print</span> a.func()</span><br></pre></td></tr></table></figure>
<h2 id="python-调用机制">Python 调用机制</h2>
<blockquote>
<p>描述</p>
</blockquote>
<p>我们知道
<code>__call__</code>方法可以用来重载圆括号调用，好的，以为问题就这么简单？Naive！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;invoking __call__ from A!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    a = A()</span><br><span class="line">    a()<span class="comment">## output: invoking __call__ from A</span></span><br></pre></td></tr></table></figure>
<p>现在我们可以看到 a() 似乎等价于 <code>a.__call__()</code> ,看起来很
Easy 对吧，好的，我现在想作死，又写出了如下的代码，</p>
<p><code>a.__call__ = lambda: "invoking __call__ from lambda"</code>
<code>a.__call__()</code></p>
<p># output:invoking <strong>call</strong> from lambda</p>
<p><code>a()</code></p>
<p># output:invoking <strong>call</strong> from A!</p>
<p>请大佬们解释下，为什么 a() 没有调用出 <code>a.__call__()</code>
(此题由 USTC 王子博前辈提出) &gt; 答案</p>
<p>原因在于，在 Python 中，新式类（ new class
)的内建特殊方法，和实例的属性字典是相互隔离的，具体可以看看 Python
官方文档对于这一情况的说明</p>
<pre><code>For new-style classes, implicit invocations of special methods are only guaranteed to work correctly if defined on an object’s type, not in the object’s instance dictionary. That behaviour is the reason why the following code raises an exception (unlike the equivalent example with old-style classes):</code></pre>
<p>同时官方也给出了一个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    <span class="comment"># def __len__(self):</span></span><br><span class="line">    <span class="comment">#   return 5</span></span><br><span class="line"></span><br><span class="line">c = C()</span><br><span class="line">c.__len__ = <span class="keyword">lambda</span>: <span class="number">5</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">len</span>(c)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Traceback (most recent call last):</span><br><span class="line">#  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line"># TypeError: object of type &#x27;C&#x27; has no len()</span><br></pre></td></tr></table></figure>
<p>回到我们的例子上来，当我们在执行
<code>a.__call__=lambda: "invoking __call__ from lambda"</code>
时，的确在我们在 <code>a.__dict__</code> 中新增加了一个 key 为
<code>__call__</code> 的 item，但是当我们执行 a()
时，因为涉及特殊方法的调用，因此我们的调用过程不会从
<code>a.__dict__</code> 中寻找属性，而是从
<code>type(a).__dict__</code>中寻找属性。因此，就会出现如上所述的情况。</p>
<h2 id="描述符">描述符</h2>
<blockquote>
<p>描述</p>
</blockquote>
<p>我想写一个 Exam 类，其属性 math 为 [0,100]
的整数，若赋值时不在此范围内则抛出异常，我决定用描述符来实现这个需求。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Grade</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._score = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__get__</span>(<span class="params">self, instance, owner</span>):</span><br><span class="line">        <span class="keyword">return</span> self._score</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__set__</span>(<span class="params">self, instance, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= value &lt;= <span class="number">100</span>:</span><br><span class="line">            self._score = value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;grade must be between 0 and 100&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Exam</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    math = Grade()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, math</span>):</span><br><span class="line">        self.math = math</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    niche = Exam(math = <span class="number">90</span>)</span><br><span class="line">    <span class="built_in">print</span>(niche.math)</span><br><span class="line">    <span class="comment"># output : 90</span></span><br><span class="line">    snake = Exam(math = <span class="number">75</span>)</span><br><span class="line">    <span class="built_in">print</span>(snake.math)</span><br><span class="line">    <span class="comment"># output : 75</span></span><br><span class="line">    snake.math = <span class="number">120</span></span><br><span class="line">    <span class="comment"># output: ValueError:grade must be between 0 and 100!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>看起来一切正常。不过这里面有个巨大的问题，尝试说明是什么问题。为了解决这个问题，我改写了
Grade 描述符如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Grade</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._grade_pool = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__get__</span>(<span class="params">self, instance, owner</span>):</span><br><span class="line">        <span class="keyword">return</span> self._grade_pool.get(instance, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__set__</span>(<span class="params">self, instance, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= value &lt;= <span class="number">100</span>:</span><br><span class="line">            _grade_pool = self.__dict__.setdefault(<span class="string">&#x27;_grade_pool&#x27;</span>,&#123;&#125;)</span><br><span class="line">            _grade_pool[instance] = value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Ooh, Value Error&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>不过这样会导致更大的问题，请问该怎么解决这个问题？</p>
<blockquote>
<p>答案</p>
</blockquote>
<ol type="1">
<li>第一个问题的其实很简单，如果你再运行一次 print(niche.math)
你就会发现，输出值是 75 ，那么这是为什么呢？这就要先从
Python的调用机制说起了。我们如果调用一个属性，那么其顺序是优先从实例的
<code>__dict__</code>
里查找，然后如果没有查找到的话，那么依次查询类字典，父类字典，直到彻底查不到为止。好的，现在回到我们的问题，我们发现，在我们的类
Exam
中，其<code>self.math</code>的调用过程是，首先在实例化后的实例的<code>__dict__</code>中进行查找，没有找到，接着往上一级，在我们的类
Exam 中进行查找，好的找到了，返回。那么这意味着，我们对于 self.math
的所有操作都是对于类变量
math的操作。因此造成变量污染的问题。那么该则怎么解决呢？很多同志可能会说，恩，在
<code>__set__</code> 函数中将值设置到具体的实例字典不就行了。</li>
</ol>
<p>那么这样可不可以呢？答案是，很明显不得行啊，至于为什么，就涉及到我们
Python 描述符的机制了，</p>
<blockquote>
<p>描述符指的是实现了描述符协议的特殊的类，三个描述符协议指的是
<code>__get__</code>, <code>__set__</code> , <code>__delete__</code>以及
Python 3.6 中新增的 <code>__set_name__</code>
方法，其中实现了<code>__get__</code> 以及
<code>__set__ / __delete__ / __set_name__</code> 的是 Data descriptors
，而只实现了 <code>__get__</code> 的是 Non-Data descriptor</p>
</blockquote>
<p>那么有什么区别呢，前面说了，
我们如果调用一个属性，那么其顺序是优先从实例的 <code>__dict__</code>
里查找，然后如果没有查找到的话，那么一次查询类字典，父类字典，直到彻底查不到为止。
但是，这里没有考虑描述符的因素进去，如果将描述符因素考虑进去，那么正确的表述应该是我们如果调用一个属性，那么其顺序是优先从实例的
<code>__dict__</code>
里查找，然后如果没有查找到的话，那么依次查询类字典，父类字典，直到彻底查不到为止。其中如果在<em>类实例字典</em>中的该属性是一个
Data descriptors
，那么无论实例字典中存在该属性与否，无条件走描述符协议进行调用，在类实例字典中的该属性是一个Non-Data
descriptors
，那么优先调用实例字典中的属性值而不触发描述符协议，如果实例字典中不存在该属性值，那么触发
Non-Data descriptor的描述符协议。回到之前的问题，我们即使在
<code>__set__</code>将具体的属性写入实例字典中，但是由于类字典中存在着
Data descriptors ，因此，我们在调用 math
属性时，依旧会触发描述符协议。</p>
<ol start="2" type="1">
<li>经过改良的做法，利用dict的key唯一性，将具体的值与实例进行绑定，但是同时带来了内存泄露的问题。那么为什么会造成内存泄露呢，首先复习下我们的
dict 的特性:</li>
</ol>
<ul>
<li>dict 最重要的一个特性，凡可 hash 的对象皆可为 key ，dict 通过利用的
hash 值的唯一性(严格意义上来讲并不是唯一，而是其 hash
值碰撞几率极小，近似认定其唯一)来保证 key 的不重复；</li>
<li>同时,
dict中的key引用是<em>强引用类型</em>,会造成对应对象的引用计数的增加，可能造成对象无法被GC,从而产生内存泄露。</li>
</ul>
<ol start="3" type="1">
<li>那么这里该怎么解决呢？两种方法</li>
</ol>
<ul>
<li>第一种：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Grade</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">import</span> weakref</span><br><span class="line">        self._grade_pool = weakref.WeakKeyDictionary()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__get__</span>(<span class="params">self,instance,owner</span>):</span><br><span class="line">        <span class="keyword">return</span> self._grade_pool.get(instance,<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__set__</span>(<span class="params">self,instance,value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= value &lt;= <span class="number">100</span>:</span><br><span class="line">            _grade_pool = self.__dict__.setdefault(<span class="string">&#x27;_grade_pool&#x27;</span>,&#123;&#125;)</span><br><span class="line">            _grade_pool[instance] = value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;fuck&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Exam</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    math = Grade()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, math</span>):</span><br><span class="line">        self.math = math</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    niche = Exam(math = <span class="number">90</span>)</span><br><span class="line">    <span class="built_in">print</span>(niche.math)</span><br><span class="line">    <span class="comment"># output : 90</span></span><br><span class="line">    snake = Exam(math = <span class="number">75</span>)</span><br><span class="line">    <span class="built_in">print</span>(snake.math)</span><br><span class="line">    <span class="comment"># output : 75</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        snake.math = <span class="number">120</span></span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span> e</span><br><span class="line">    <span class="built_in">print</span> niche.math</span><br></pre></td></tr></table></figure>
<p>weakref 库中的 WeakKeyDictionary 所产生的字典的 key
对于<em>对象的引用是弱引用类型</em>，其不会造成内存引用计数的增加，因此不会造成内存泄露。同理，如果我们为了避免
value 对于对象的强引用，我们可以使用 WeakValueDictionary 。</p>
<ul>
<li>第二种：在<strong>Python 3.6 </strong>中，实现的PEP 487
提案，为描述符新增加了一个协议<code>__set_name__</code>，我们可以用其来绑定对应的对象：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Grade</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__get__</span>(<span class="params">self, instance, owner</span>):</span><br><span class="line">        <span class="keyword">return</span> instance.__dict__[self.key]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__set__</span>(<span class="params">self, instance, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= value &lt;= <span class="number">100</span>:</span><br><span class="line">            instance.__dict__[self.key] = value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;fuck&quot;</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__set_name__</span>(<span class="params">self, owner, name</span>):</span><br><span class="line">        self.key = name</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这道题涉及的东西比较多，这里给出一点参考链接 -
invoking-descriptors(https://docs.python.org/2/reference/datamodel.html#invoking-descriptors)<br />
- Descriptor HowTo
Guide(https://docs.python.org/3/howto/descriptor.html)<br />
- PEP
487(https://www.python.org/dev/peps/pep-0487/#adding-a-class-attribute-with-the-attribute-order)
- what`s new in Python
3.6(https://docs.python.org/3.6/whatsnew/3.6.html)</p>
<h2 id="python-继承机制">Python 继承机制</h2>
<blockquote>
<p>描述</p>
</blockquote>
<p>试求出以下代码的输出结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Init</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        self.val = value</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;init&quot;</span>, self.val</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Add2</span>(<span class="title class_ inherited__">Init</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, val</span>):</span><br><span class="line">        <span class="built_in">super</span>(Add2, self).__init__(val)</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Add2 Before:&quot;</span>, self.val</span><br><span class="line">        self.val += <span class="number">2</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Add2&quot;</span>, self.val</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mul5</span>(<span class="title class_ inherited__">Init</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, val</span>):</span><br><span class="line">        <span class="built_in">super</span>(Mul5, self).__init__(val)</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Mul5 Before:&quot;</span>, self.val</span><br><span class="line">        self.val *= <span class="number">5</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Mul5&quot;</span>, self.val</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Pro</span>(Mul5, Add2):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Incr</span>(<span class="title class_ inherited__">Pro</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, val</span>):</span><br><span class="line">        <span class="built_in">super</span>(Pro, self).__init__(val)</span><br><span class="line">        self.val += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Incr&quot;</span>, self.val</span><br><span class="line"></span><br><span class="line">p = Incr(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(p.val)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>答案</p>
</blockquote>
<pre><code>输出是 36 ，具体可以参考 New-style Classes , multiple-inheritance</code></pre>
<h2 id="python-特殊方法">Python 特殊方法</h2>
<pre><code>描述
我写了一个通过重载 new 方法来实现单例模式的类。</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> self._instance:</span><br><span class="line">            <span class="keyword">return</span> self._instance</span><br><span class="line">        self._instance = cv = <span class="built_in">object</span>.__new__(self, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cv</span><br><span class="line"></span><br><span class="line">sin1 = Singleton()</span><br><span class="line">sin2 = Singleton()</span><br><span class="line"><span class="built_in">print</span>(sin1 <span class="keyword">is</span> sin2)</span><br><span class="line"><span class="built_in">print</span> Singleton() <span class="keyword">is</span> sin2</span><br><span class="line"></span><br><span class="line"><span class="comment"># output: True</span></span><br></pre></td></tr></table></figure>
<p>现在我有一堆类要实现为单例模式，所以我打算照葫芦画瓢写一个元类，这样可以让代码复用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SingleMeta</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, bases, <span class="built_in">dict</span></span>):</span><br><span class="line">        self._instance = <span class="literal">None</span></span><br><span class="line">        __new__o = self.__new__</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">            <span class="keyword">if</span> self._instance:</span><br><span class="line">                <span class="keyword">return</span> self._instance</span><br><span class="line">            self._instance = cv = __new__o(self, *args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> cv</span><br><span class="line">        self.__new__ = __new__</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    __metaclass__ = SingleMeta</span><br><span class="line"></span><br><span class="line">a1 = A() <span class="comment"># what`s the fuck</span></span><br></pre></td></tr></table></figure>
<p>哎，为啥这会报错啊，我明明之前用这种方法给
<code>__getattribute__</code>打补丁的，下面这段代码能够捕获一切属性调用并打印参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TraceAttribute</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">cls, name, bases, <span class="built_in">dict</span></span>):</span><br><span class="line">        __getattribute__o = cls.__getattribute__</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__getattribute__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;__getattribute__:&#x27;</span>, args, kwargs)</span><br><span class="line">            <span class="keyword">return</span> __getattribute__o(self, *args, **kwargs)</span><br><span class="line">        cls.__getattribute__ = __getattribute__</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):  <span class="comment"># Python 3 是 class A(object,metaclass=TraceAttribute):</span></span><br><span class="line">    __metaclass__ = TraceAttribute</span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    b = <span class="number">2</span></span><br><span class="line">a = A()</span><br><span class="line">a.a</span><br><span class="line">a.b</span><br></pre></td></tr></table></figure>
<p>a.b</p>
<p>试解释为什么给 getattribute 打补丁成功，而 new 打补丁失败。
如果我坚持使用元类给 new 打补丁来实现单例模式，应该怎么修改？</p>
<blockquote>
<p>答案</p>
</blockquote>
<p>其实这是最气人的一点，类里的<code>__new__</code>是一个
<strong>staticmethod</strong> 因此替换的时候必须以
<strong>staticmethod</strong> 进行替换。答案如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SingleMeta</span>(<span class="title class_ inherited__">type</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, bases, <span class="built_in">dict</span></span>):</span><br><span class="line">        self._instance = <span class="literal">None</span></span><br><span class="line">        __new__o = self.__new__</span><br><span class="line"></span><br><span class="line"><span class="meta">        @staticmethod</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">            <span class="keyword">if</span> self._instance:</span><br><span class="line">                <span class="keyword">return</span> self._instance</span><br><span class="line">            self._instance = cv = __new__o(self, *args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> cv</span><br><span class="line">        self.__new__ = __new__</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    __metaclass__ = SingleMeta</span><br><span class="line"></span><br><span class="line">a1 = A() <span class="comment"># what`s the fuck</span></span><br></pre></td></tr></table></figure>
<h2 id="多线程是真的多线程吗">多线程是真的多线程吗？</h2>
<blockquote>
<p>Effective Python
第37条：可以使用线程来执行阻塞式IO，但是不要用它做平行计算。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python2.7</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep, ctime</span><br><span class="line"></span><br><span class="line">loops = [<span class="number">4</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadFunc</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, func, args, name=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">        self.name = name </span><br><span class="line">        self.func = func</span><br><span class="line">        self.args = args </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self</span>):</span><br><span class="line">        apply(self.func, self.args)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loop</span>(<span class="params">nloop, nsec</span>):</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;start loop &quot;</span>, nloop, <span class="string">&quot;at:&quot;</span>, ctime()</span><br><span class="line">    a = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">30000000</span>):</span><br><span class="line">        a += i</span><br><span class="line">    <span class="built_in">print</span> a</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;loop &quot;</span>, nloop, <span class="string">&quot;done at:&quot;</span>, ctime()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main_with_muilt_thread</span>():</span><br><span class="line">    threads = []</span><br><span class="line">    nloops = <span class="built_in">range</span>(<span class="built_in">len</span>(loops))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> nloops:</span><br><span class="line">        t = threading.Thread(target=ThreadFunc(loop,(i, loops[i]),loop.__name__))</span><br><span class="line">        threads.append(t)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;starting at:&quot;</span>, ctime()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> nloops:</span><br><span class="line">        threads[i].start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> nloops:</span><br><span class="line">        threads[i].join()</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;all DONE at:&quot;</span>, ctime()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main_with_one_thread</span>():</span><br><span class="line">    threads = []</span><br><span class="line">    nloops = <span class="built_in">range</span>(<span class="built_in">len</span>(loops))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> nloops:</span><br><span class="line">        t = threading.Thread(target=ThreadFunc(loop,(i, loops[i]),loop.__name__))</span><br><span class="line">        threads.append(t)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;starting at:&quot;</span>,ctime()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> nloops:</span><br><span class="line">        loop(i, loops[i])</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;all DONE at:&quot;</span>,ctime()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main_with_one_thread()</span><br><span class="line">    main_with_muilt_thread()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>output</p>
</blockquote>
<pre><code>starting at: Sun Jul 30 20:05:28 2017
start loop  0 at: Sun Jul 30 20:05:28 2017
449999985000000
loop  0 done at: Sun Jul 30 20:05:30 2017
start loop  1 at: Sun Jul 30 20:05:30 2017
449999985000000
loop  1 done at: Sun Jul 30 20:05:32 2017
all DONE at: Sun Jul 30 20:05:32 2017
starting at: Sun Jul 30 20:05:32 2017
start loop  0 at: Sun Jul 30 20:05:32 2017start loop 
1 at: Sun Jul 30 20:05:32 2017
449999985000000
loop  0 done at: Sun Jul 30 20:05:40 2017
449999985000000
loop  1 done at: Sun Jul 30 20:05:40 2017
all DONE at: Sun Jul 30 20:05:40 2017</code></pre>
<p>从中看出，使用单线程顺序执行时使用了4s，但是使用多线程执行了8s。本来使用多线程应该是原的两倍才对啊，但是现在多线程竟然比但想成还慢。因为<strong>标准CPython解释器中的多线程受到了GIL的影响，同一时刻只能有一个线程得到执行</strong>。但是为啥还要支持多线程呢？
1. 程序看上去可以同时执行很多个事情，免去了手工管理任务的切换操作 2.
处理阻塞式IO操作。Python执行某些系统调用时，会触发阻塞式操作。读写文件，在网络间通讯，显示器与设计之间交互都属于阻塞式IO。为了响应阻塞式请求，开发者可以借助线程，把python程序与这些耗时IO操作隔离开来。</p>
<h2 id="python中一些忽视的性质">Python中一些忽视的性质</h2>
<ol type="1">
<li><p><code>eval</code> 与<code>ast.literal_eval</code>:
literal_eval相对来说比较安全，只有字符串中包含表达式的时候才会评估。</p></li>
<li><p>实现一组字符串分组分开：<code>itertools.groupby</code>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from itertools import groupby</span><br><span class="line">s = &quot;1123433364433&quot;</span><br><span class="line">print([&#x27;&#x27;.join(i) for _, i in groupby(s)])</span><br></pre></td></tr></table></figure></p></li>
<li><p>判断list是否为空 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if not l:</span><br><span class="line">	pass</span><br></pre></td></tr></table></figure> 就是最好的选择 <a
target="_blank" rel="noopener" href="https://stackoverflow.com/questions/53513/how-do-i-check-if-a-list-is-empty?rq=1">how-do-i-check-if-a-list-is-empty</a></p></li>
<li><p>从json文件中读取参数 <a
target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2835559/parsing-values-from-a-json-file?noredirect=1&amp;lq=1">parse
values from a json file</a></p></li>
<li><p>各种<code>@property</code>的实现 <a
target="_blank" rel="noopener" href="https://stackoverflow.com/questions/17330160/how-does-the-property-decorator-work">python
property的作用</a> <a
target="_blank" rel="noopener" href="https://stackoverflow.com/questions/3012421/python-memoising-deferred-lookup-property-decorator">python
property的重定义</a></p></li>
</ol>
<h2 id="常见问题">常见问题</h2>
<h2 id="pip安装package出现read-timed-out.">pip安装package出现Read timed
out.</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxx@xxxx:~/Repo/engine/online_index/webpy-master$ pip install cheroot-6.0.0-py2.py3-none-any.whl </span><br><span class="line">Processing ./cheroot-6.0.0-py2.py3-none-any.whl</span><br><span class="line">Requirement already satisfied: six&gt;=1.11.0 <span class="keyword">in</span> /opt/anaconda2/lib/python2.7/site-packages (from cheroot==6.0.0)</span><br><span class="line">Collecting more-itertools&gt;=2.6 (from cheroot==6.0.0)</span><br><span class="line">Retrying (Retry(total=4, connect=None, <span class="built_in">read</span>=None, redirect=None)) after connection broken by <span class="string">&#x27;ReadTimeoutError(&quot;HTTPSConnectionPool(host=&#x27;</span>pypi.python.org<span class="string">&#x27;, port=443): Read timed out. (read timeout=15)&quot;,)&#x27;</span>: /simple/more-itertools/</span><br><span class="line">Retrying (Retry(total=3, connect=None, <span class="built_in">read</span>=None, redirect=None)) after connection broken by <span class="string">&#x27;ReadTimeoutError(&quot;HTTPSConnectionPool(host=&#x27;</span>pypi.python.org<span class="string">&#x27;, port=443): Read timed out. (read timeout=15)&quot;,)&#x27;</span>: /simple/more-itertools/</span><br><span class="line">Retrying (Retry(total=2, connect=None, <span class="built_in">read</span>=None, redirect=None)) after connection broken by <span class="string">&#x27;ReadTimeoutError(&quot;HTTPSConnectionPool(host=&#x27;</span>pypi.python.org<span class="string">&#x27;, port=443): Read timed out. (read timeout=15)&quot;,)&#x27;</span>: /simple/more-itertools/</span><br><span class="line">Retrying (Retry(total=1, connect=None, <span class="built_in">read</span>=None, redirect=None)) after connection broken by <span class="string">&#x27;ReadTimeoutError(&quot;HTTPSConnectionPool(host=&#x27;</span>pypi.python.org<span class="string">&#x27;, port=443): Read timed out. (read timeout=15)&quot;,)&#x27;</span>: /simple/more-itertools/</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="解决方案">解决方案</h3>
<p>安装过程中添加信赖的地址，尤其是在某些互联网公司中，由于安全，防火墙等等安全考虑，会将pip默认的host地址作为不信任。
xxx@xxxx:~/Repo/engine/online_index/webpy-master$ pip install web.py -i
http://pypi.douban.com/simple --trusted-host pypi.douban.com</p>
<p>在pip.conf中加入trusted-host选项，该方法是一劳永逸 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">index-url = http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line">[install]</span><br><span class="line">trusted-host=mirrors.aliyun.com</span><br></pre></td></tr></table></figure></p>
<h2 id="参考文献">参考文献</h2>
<p>[1]. [Someone-tell-me-that-you-think-Python-is-simple]<a
target="_blank" rel="noopener" href="https://manjusaka.itscoder.com/2016/11/18/Someone-tell-me-that-you-think-Python-is-simple/"
class="uri">https://manjusaka.itscoder.com/2016/11/18/Someone-tell-me-that-you-think-Python-is-simple/</a></p>
<p>[2].[invoking-descriptors]<a
target="_blank" rel="noopener" href="https://docs.python.org/2/reference/datamodel.html#invoking-descriptors"
class="uri">https://docs.python.org/2/reference/datamodel.html#invoking-descriptors</a></p>
<p>[3].[Descriptor HowTo Guide]<a
target="_blank" rel="noopener" href="https://docs.python.org/3/howto/descriptor.html"
class="uri">https://docs.python.org/3/howto/descriptor.html</a></p>
<p>[4].[Python代码规范PEP 487]<a
target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0487/#adding-a-class-attribute-with-the-attribute-order"
class="uri">https://www.python.org/dev/peps/pep-0487/#adding-a-class-attribute-with-the-attribute-order</a></p>
<p>[5].[what`s new in Python 3.6]<a
target="_blank" rel="noopener" href="https://docs.python.org/3.6/whatsnew/3.6.html"
class="uri">https://docs.python.org/3.6/whatsnew/3.6.html</a></p>
<p>[6].[Python相见恨晚的库]<a
target="_blank" rel="noopener" href="https://www.zhihu.com/question/24590883"
class="uri">https://www.zhihu.com/question/24590883</a></p>
<p>[7]. [python recipes]<a
target="_blank" rel="noopener" href="https://github.com/cwlseu/pyrecipes.git"
class="uri">https://github.com/cwlseu/pyrecipes.git</a></p>

    </div>

    
    
    
      


    <footer class="post-footer"><div class="post-widgets">
    <div
      class="social-share"
      
        data-sites="weibo,qq,wechat,tencent,douban,qzone,linkedin,diandian,facebook,twitter,google"
      
      
        data-wechat-qrcode-title="share.title"
      
      
        data-wechat-qrcode-helper="share.prompt"
      
    >
    </div>
  </div>
  <script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js"></script>
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>CharlesCao
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://www.deepindeed.cn/201812/20181214-python-tips/" title="Python中的一些奇淫技巧">http://www.deepindeed.cn/201812/20181214-python-tips/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"># Python</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/201812/20181204-dev-problem-android-string-crash/" rel="prev" title="android开发中奇怪crash问题">
                  <i class="fa fa-chevron-left"></i> android开发中奇怪crash问题
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/201901/20190110-CMake-Makefile/" rel="next" title="Make & CMake 进阶">
                  Make & CMake 进阶 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CharlesCao</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">425k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">11:48</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://lib.baomitu.com/canvas-nest.js/1.0.1/canvas-nest.js"></script>


    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@9.0.1/dist/mermaid.min.js","integrity":"sha256-CemUs9ITT7liCZpVMktcEw0BpAOZ1+mujlMB3UyuImU="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>



  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"libUrl":"https://unpkg.com/@waline/client@v2/dist/waline.js","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo","https://unpkg.com/@waline/emojis@1.0.1/alus","https://unpkg.com/@waline/emojis@1.0.1/bilibili","https://unpkg.com/@waline/emojis@1.0.1/qq","https://unpkg.com/@waline/emojis@1.0.1/tieba","https://unpkg.com/@waline/emojis@1.0.1/tw-emoji"],"meta":["nick","mail"],"requiredMeta":["mail"],"el":"#waline","comment":true,"path":"/201812/20181214-python-tips/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

</body>
</html>
